#!/bin/sh
# 获取提交信息文件路径
COMMIT_MSG_FILE=$1

COMMIT_SOURCE=$2

echo "$COMMIT_SOURCE"

# 如果用户使用 --amend 参数，直接跳过模板插入
if [ "$COMMIT_SOURCE" = "commit" ]; then
  exit 0
fi

# 如果用户使用 -m 参数，给出警告并退出
if [ "$COMMIT_SOURCE" = "message" ]; then
  echo "Error: donn't use -m parameter"
  exit 1
fi

# 获取当前分支名
BRANCH=$(git rev-parse --abbrev-ref HEAD)

# 获取版本号
VERSION=$(date '+%Y%m%d')

# 交互式选择类型
echo "请选择提交类型："
select TYPE in "Bug" "INTERNAL" "NBF"; do
  case $TYPE in
    "Bug" | "INTERNAL" | "NBF")
      break
      ;;
    *)
      echo "无效的选择，请重试。"
      ;;
  esac
done

# 交互式填写 Cause
echo "请输入 Cause（按 Enter 跳过）："
read CAUSE

# 交互式填写 Solution
echo "请输入 Solution（按 Enter 跳过）："
read SOLUTION

# 生成提交信息模板
TEMPLATE="[$TYPE] 
[Cause]: ${CAUSE:-None}
[Solution]: ${SOLUTION:-None}
[Fixed Version]: $VERSION
[Branch]: $BRANCH"

echo "$TEMPLATE" > "$COMMIT_MSG_FILE"